<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ajouter un message</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Ajouter un message</h1>
  <form id="messageForm">
    <input type="text" id="content" placeholder="Texte ou URL d'image" required>
    <button type="submit">Ajouter</button>
  </form>

  <script>
    const API_URL = "https://api.jsonbin.io/v3/b/68d7f48943b1c97be9520d19";
    const API_KEY = "$2a$10$q1i..XKCzCiJD3PB2CkpZekd5JELUiJJd/byW6PYaU7yItZzvbemy";

    async function fetchMessages() {
      const res = await fetch(API_URL + "/latest", {
        headers: { "X-Master-Key": API_KEY }
      });
      const data = await res.json();
      return data.record || [];
    }

    function detectType(content) {
      const imageRegex = /\.(jpeg|jpg|png|gif|webp|svg)$/i;
      return imageRegex.test(content) ? "image" : "text";
    }

    document.getElementById("messageForm").addEventListener("submit", async e => {
      e.preventDefault();
      const content = document.getElementById("content").value.trim();
      if (!content) return;

      const messages = await fetchMessages();
      messages.push({ type: detectType(content), content });

      await fetch(API_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": API_KEY
        },
        body: JSON.stringify(messages)
      });

      document.getElementById("content").value = "";
      alert("Message ajout√© !");
    });
  </script>
</body>
</html>